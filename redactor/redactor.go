//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package redactor ;import (_f "errors";_df "fmt";_c "github.com/unidoc/unipdf/v3/common";_g "github.com/unidoc/unipdf/v3/contentstream";_b "github.com/unidoc/unipdf/v3/core";_ac "github.com/unidoc/unipdf/v3/creator";_cd "github.com/unidoc/unipdf/v3/extractor";
_ce "github.com/unidoc/unipdf/v3/model";_fb "io";_e "regexp";_dd "sort";_a "strings";);func (_eafg *regexMatcher )match (_agbg string )([]*matchedIndex ,error ){_dac :=_eafg ._eefe .Pattern ;if _dac ==nil {return nil ,_f .New ("\u006e\u006f\u0020\u0070at\u0074\u0065\u0072\u006e\u0020\u0063\u006f\u006d\u0070\u0069\u006c\u0065\u0064");
};var (_ecgg =_dac .FindAllStringIndex (_agbg ,-1);_dfdag []*matchedIndex ;);for _ ,_cegae :=range _ecgg {_dfdag =append (_dfdag ,&matchedIndex {_dcgea :_cegae [0],_abg :_cegae [1],_dade :_agbg [_cegae [0]:_cegae [1]]});};return _dfdag ,nil ;};

// New instantiates a Redactor object with given PdfReader and `regex` pattern.
func New (reader *_ce .PdfReader ,opts *RedactionOptions ,rectProps *RectangleProps )*Redactor {if rectProps ==nil {rectProps =RedactRectanglePropsNew ();};return &Redactor {_baed :reader ,_gca :opts ,_feba :_ac .New (),_dgga :rectProps };};func _ccfa (_eba []*matchedIndex )[]*targetMap {_cdgf :=make (map[string ][][]int );
_fbcc :=[]*targetMap {};for _ ,_edbce :=range _eba {_dbgc :=_edbce ._dade ;_decd :=[]int {_edbce ._dcgea ,_edbce ._abg };if _afcc ,_gbbf :=_cdgf [_dbgc ];_gbbf {_cdgf [_dbgc ]=append (_afcc ,_decd );}else {_cdgf [_dbgc ]=[][]int {_decd };};};for _fab ,_ebba :=range _cdgf {_gadd :=&targetMap {_ffe :_fab ,_cddb :_ebba };
_fbcc =append (_fbcc ,_gadd );};return _fbcc ;};func _fe (_eg *_g .ContentStreamOperations ,_ea map[_b .PdfObject ][]localSpanMarks )error {for _ee ,_cg :=range _ea {if _ee ==nil {continue ;};_cee ,_bg ,_ed :=_bcd (_eg ,_ee );if !_ed {_c .Log .Debug ("Pd\u0066\u004fb\u006a\u0065\u0063\u0074\u0020\u0025\u0073\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0073\u0069\u0064\u0065\u0020\u0074\u0068\u0065\u0020\u0063\u006f\u006e\u0074\u0065\u006e\u0074\u0073\u0074r\u0065a\u006d\u0020\u006f\u0070\u0065\u0072\u0061\u0074i\u006fn\u0020\u0025s",_ee ,_eg );
return nil ;};if _cee .Operand =="\u0054\u006a"{_af :=_bgd (_cee ,_ee ,_cg );if _af !=nil {return _af ;};}else if _cee .Operand =="\u0054\u004a"{_dg :=_gd (_cee ,_ee ,_cg );if _dg !=nil {return _dg ;};}else if _cee .Operand =="\u0027"||_cee .Operand =="\u0022"{_dfe :=_db (_eg ,_cee .Operand ,_bg );
if _dfe !=nil {return _dfe ;};_dfe =_bgd (_cee ,_ee ,_cg );if _dfe !=nil {return _dfe ;};};};return nil ;};func _cafg (_bdgg _b .PdfObject ,_dgg *_ce .PdfFont )(string ,error ){_cad ,_egc :=_b .GetStringBytes (_bdgg );if !_egc {return "",_b .ErrTypeError ;
};_edbaa :=_dgg .BytesToCharcodes (_cad );_ccd ,_egg ,_cfee :=_dgg .CharcodesToStrings (_edbaa );if _cfee > 0{_c .Log .Debug ("\u0072\u0065nd\u0065\u0072\u0054e\u0078\u0074\u003a\u0020num\u0043ha\u0072\u0073\u003d\u0025\u0064\u0020\u006eum\u004d\u0069\u0073\u0073\u0065\u0073\u003d%\u0064",_egg ,_cfee );
};_bgg :=_a .Join (_ccd ,"");return _bgg ,nil ;};func _ab (_ged *_cd .TextMarkArray )*_ce .PdfFont {_ ,_afab :=_bge (_ged );_eege :=_ged .Elements ()[_afab ];_eac :=_eege .Font ;return _eac ;};func _caa (_ggff *_cd .TextMarkArray )string {_ebg :="";for _ ,_dcbd :=range _ggff .Elements (){_ebg +=_dcbd .Text ;
};return _ebg ;};func _eaf (_gbd string ,_efd []localSpanMarks )([]placeHolders ,error ){_bca :="";_bbb :=[]placeHolders {};for _fbc ,_aff :=range _efd {_ege :=_aff ._faa ;_fgd :=_aff ._ccf ;_ggg :=_caa (_ege );_deaf ,_fda :=_eegec (_ege );if _fda !=nil {return nil ,_fda ;
};if _ggg !=_bca {var _ggb []int ;if _fbc ==0&&_fgd !=_ggg {_gab :=_a .Index (_gbd ,_ggg );_ggb =[]int {_gab };}else if _fbc ==len (_efd )-1{_gae :=_a .LastIndex (_gbd ,_ggg );_ggb =[]int {_gae };}else {_ggb =_acbb (_gbd ,_ggg );};_bga :=placeHolders {_cf :_ggb ,_ff :_ggg ,_bc :_deaf };
_bbb =append (_bbb ,_bga );};_bca =_ggg ;};return _bbb ,nil ;};

// RedactRectanglePropsNew return a new pointer to a default RectangleProps object.
func RedactRectanglePropsNew ()*RectangleProps {return &RectangleProps {FillColor :_ac .ColorBlack ,BorderWidth :0.0,FillOpacity :1.0};};func _bgd (_dcg *_g .ContentStreamOperation ,_cdd _b .PdfObject ,_bfb []localSpanMarks )error {var _cggd *_b .PdfObjectArray ;
_dgfc ,_egfd :=_ceda (_bfb );if len (_egfd )==1{_gda :=_egfd [0];_cfd :=_dgfc [_gda ];if len (_cfd )==1{_cdc :=_cfd [0];_bae :=_cdc ._faa ;_abb :=_ab (_bae );_abf ,_aeb :=_cafg (_cdd ,_abb );if _aeb !=nil {return _aeb ;};_cb ,_aeb :=_gaa (_cdc ,_bae ,_abb ,_abf ,_gda );
if _aeb !=nil {return _aeb ;};_cggd =_b .MakeArray (_cb ...);}else {_gdaf :=_cfd [0]._faa ;_ecd :=_ab (_gdaf );_abe ,_adc :=_cafg (_cdd ,_ecd );if _adc !=nil {return _adc ;};_bda ,_adc :=_eaf (_abe ,_cfd );if _adc !=nil {return _adc ;};_ead :=_fef (_bda );
_gc :=_fcd (_abe ,_ead ,_ecd );_cggd =_b .MakeArray (_gc ...);};}else if len (_egfd )> 1{_cgb :=_bfb [0];_egfg :=_cgb ._faa ;_ ,_adg :=_bge (_egfg );_bdae :=_egfg .Elements ()[_adg ];_bcc :=_bdae .Font ;_gfea ,_fc :=_cafg (_cdd ,_bcc );if _fc !=nil {return _fc ;
};_dad ,_fc :=_eaf (_gfea ,_bfb );if _fc !=nil {return _fc ;};_fag :=_fef (_dad );_ece :=_fcd (_gfea ,_fag ,_bcc );_cggd =_b .MakeArray (_ece ...);};_dcg .Params [0]=_cggd ;_dcg .Operand ="\u0054\u004a";return nil ;};func _abed (_dcgg ,_aded targetMap )(bool ,[]int ){_fbb :=_a .Contains (_dcgg ._ffe ,_aded ._ffe );
var _cdee []int ;for _ ,_gec :=range _dcgg ._cddb {for _cdeg ,_dbf :=range _aded ._cddb {if _dbf [0]>=_gec [0]&&_dbf [1]<=_gec [1]{_cdee =append (_cdee ,_cdeg );};};};return _fbb ,_cdee ;};func _eegec (_deec *_cd .TextMarkArray )(float64 ,error ){_dfeg ,_aed :=_deec .BBox ();
if !_aed {return 0.0,_df .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_deec );
};_agbb :=_dgb (_deec );_cea :=0.0;_ ,_aad :=_bge (_deec );_cfda :=_deec .Elements ()[_aad ];_egef :=_cfda .Font ;if _agbb > 0{_cea =_ffc (_egef ,_cfda );};_fgdf :=(_dfeg .Urx -_dfeg .Llx );_fgdf =_fgdf +_cea *float64 (_agbb );Tj :=_bgae (_fgdf ,_cfda .FontSize ,_cfda .Th );
return Tj ,nil ;};type matchedBBox struct{_gcg _ce .PdfRectangle ;_aegc string ;};type placeHolders struct{_cf []int ;_ff string ;_bc float64 ;};

// WriteToFile writes the redacted document to file specified by `outputPath`.
func (_bcca *Redactor )WriteToFile (outputPath string )error {if _dff :=_bcca ._feba .WriteToFile (outputPath );_dff !=nil {return _df .Errorf ("\u0066\u0061\u0069l\u0065\u0064\u0020\u0074o\u0020\u0077\u0072\u0069\u0074\u0065\u0020t\u0068\u0065\u0020\u006f\u0075\u0074\u0070\u0075\u0074\u0020\u0066\u0069\u006c\u0065");
};return nil ;};func _bcd (_acc *_g .ContentStreamOperations ,PdfObj _b .PdfObject )(*_g .ContentStreamOperation ,int ,bool ){for _affe ,_bgab :=range *_acc {_dgag :=_bgab .Operand ;if _dgag =="\u0054\u006a"{_ega :=_b .TraceToDirectObject (_bgab .Params [0]);
if _ega ==PdfObj {return _bgab ,_affe ,true ;};}else if _dgag =="\u0054\u004a"{_fbga ,_afg :=_b .GetArray (_bgab .Params [0]);if !_afg {return nil ,_affe ,_afg ;};for _ ,_dfd :=range _fbga .Elements (){if _dfd ==PdfObj {return _bgab ,_affe ,true ;};};}else if _dgag =="\u0022"{_gad :=_b .TraceToDirectObject (_bgab .Params [2]);
if _gad ==PdfObj {return _bgab ,_affe ,true ;};}else if _dgag =="\u0027"{_gaf :=_b .TraceToDirectObject (_bgab .Params [0]);if _gaf ==PdfObj {return _bgab ,_affe ,true ;};};};return nil ,-1,false ;};func _db (_edb *_g .ContentStreamOperations ,_eed string ,_fa int )error {_gb :=_g .ContentStreamOperations {};
var _ag _g .ContentStreamOperation ;for _ef ,_gg :=range *_edb {if _ef ==_fa {if _eed =="\u0027"{_dgc :=_g .ContentStreamOperation {Operand :"\u0054\u002a"};_gb =append (_gb ,&_dgc );_ag .Params =_gg .Params ;_ag .Operand ="\u0054\u006a";_gb =append (_gb ,&_ag );
}else if _eed =="\u0022"{_be :=_gg .Params [:2];Tc ,Tw :=_be [0],_be [1];_cff :=_g .ContentStreamOperation {Params :[]_b .PdfObject {Tc },Operand :"\u0054\u0063"};_gb =append (_gb ,&_cff );_cff =_g .ContentStreamOperation {Params :[]_b .PdfObject {Tw },Operand :"\u0054\u0077"};
_gb =append (_gb ,&_cff );_ag .Params =[]_b .PdfObject {_gg .Params [2]};_ag .Operand ="\u0054\u006a";_gb =append (_gb ,&_ag );};};_gb =append (_gb ,_gg );};*_edb =_gb ;return nil ;};func _bbf (_dgce *_cd .TextMarkArray )[]*_cd .TextMarkArray {_faag :=_dgce .Elements ();
_acd :=len (_faag );var _ecea _b .PdfObject ;_cdbc :=[]*_cd .TextMarkArray {};_cdga :=&_cd .TextMarkArray {};_bggd :=-1;for _fgcf ,_cded :=range _faag {_dbgg :=_cded .DirectObject ;_bggd =_cded .Index ;if _dbgg ==nil {_adeda :=_dgcg (_dgce ,_fgcf ,_bggd );
if _ecea !=nil {if _adeda ==-1||_adeda > _fgcf {_cdbc =append (_cdbc ,_cdga );_cdga =&_cd .TextMarkArray {};};};}else if _dbgg !=nil &&_ecea ==nil {if _bggd ==0&&_fgcf > 0{_cdbc =append (_cdbc ,_cdga );_cdga =&_cd .TextMarkArray {};};}else if _dbgg !=nil &&_ecea !=nil {if _dbgg !=_ecea {_cdbc =append (_cdbc ,_cdga );
_cdga =&_cd .TextMarkArray {};};};_ecea =_dbgg ;_cdga .Append (_cded );if _fgcf ==(_acd -1){_cdbc =append (_cdbc ,_cdga );};};return _cdbc ;};

// Redactor represents a Redactor object.
type Redactor struct{_baed *_ce .PdfReader ;_gca *RedactionOptions ;_feba *_ac .Creator ;_dgga *RectangleProps ;};

// RedactionOptions is a collection of RedactionTerm objects.
type RedactionOptions struct{Terms []RedactionTerm ;};func _acf (_dab string ,_cgc *_ce .PdfFont )[]byte {_gbg ,_ceeg :=_cgc .StringToCharcodeBytes (_dab );if _ceeg !=0{_c .Log .Debug ("\u0057\u0041\u0052\u004e\u003a\u0020\u0073\u006fm\u0065\u0020\u0072un\u0065\u0073\u0020\u0063\u006f\u0075l\u0064\u0020\u006e\u006f\u0074\u0020\u0062\u0065\u0020\u0065\u006e\u0063\u006f\u0064\u0065d\u002e\u000a\u0009\u0025\u0073\u0020\u002d\u003e \u0025\u0076",_dab ,_gbg );
};return _gbg ;};func (_cgag *Redactor )redactPage (_eaa *_g .ContentStreamOperations ,_agc *_ce .PdfPageResources )([]matchedBBox ,*_g .ContentStreamOperations ,error ){_edbe ,_gag :=_cd .NewFromContents (_eaa .String (),_agc );if _gag !=nil {return nil ,nil ,_gag ;
};_fdg ,_ ,_ ,_gag :=_edbe .ExtractPageText ();if _gag !=nil {return nil ,nil ,_gag ;};_eaa =_fdg .GetContentStreamOps ();_dfgb :=_fdg .Marks ();_dbbge :=_fdg .Text ();_dbbge ,_bec :=_ggeg (_dbbge );_befe :=[]matchedBBox {};_bfd :=make (map[_b .PdfObject ][]localSpanMarks );
_eef :=[]*targetMap {};for _ ,_gefa :=range _cgag ._gca .Terms {_cbd ,_bbg :=_dba (_gefa );if _bbg !=nil {return nil ,nil ,_bbg ;};_efag ,_bbg :=_cbd .match (_dbbge );if _bbg !=nil {return nil ,nil ,_bbg ;};_efag =_agbf (_efag ,_bec );_gfa :=_ccfa (_efag );
_eef =append (_eef ,_gfa ...);};_cbef (_eef );for _ ,_cffe :=range _eef {_cgdb :=_cffe ._ffe ;_bcf :=_cffe ._cddb ;_ace :=[]matchedBBox {};for _ ,_fcg :=range _bcf {_befg ,_ddd ,_afbf :=_aadc (_fcg ,_dfgb ,_cgdb );if _afbf !=nil {return nil ,nil ,_afbf ;
};_edde :=_bbf (_befg );for _gbc ,_cab :=range _edde {_becb :=localSpanMarks {_faa :_cab ,_adb :_gbc ,_ccf :_cgdb };_bbe ,_ :=_bge (_cab );if _ceb ,_cdcf :=_bfd [_bbe ];_cdcf {_bfd [_bbe ]=append (_ceb ,_becb );}else {_bfd [_bbe ]=[]localSpanMarks {_becb };
};};_ace =append (_ace ,_ddd );};_befe =append (_befe ,_ace ...);};_gag =_fe (_eaa ,_bfd );if _gag !=nil {return nil ,nil ,_gag ;};return _befe ,_eaa ,nil ;};func _bgae (_cgdc ,_feg ,_dec float64 )float64 {_dec =_dec /100;_acb :=(-1000*_cgdc )/(_feg *_dec );
return _acb ;};func _dgb (_bd *_cd .TextMarkArray )int {_fbd :=0;_bdc :=_bd .Elements ();if _bdc [0].Text =="\u0020"{_fbd ++;};if _bdc [_bd .Len ()-1].Text =="\u0020"{_fbd ++;};return _fbd ;};

// Redact executes the redact operation on a pdf file and updates the content streams of all pages of the file.
func (_bbbf *Redactor )Redact ()error {_dbcd ,_aga :=_bbbf ._baed .GetNumPages ();if _aga !=nil {return _df .Errorf ("\u0066\u0061\u0069\u006c\u0065\u0064 \u0074\u006f\u0020\u0067\u0065\u0074\u0020\u0074\u0068\u0065\u0020\u006e\u0075m\u0062\u0065\u0072\u0020\u006f\u0066\u0020P\u0061\u0067\u0065\u0073");
};_ccg :=_bbbf ._dgga .FillColor ;_cbc :=_bbbf ._dgga .BorderWidth ;_ffcb :=_bbbf ._dgga .FillOpacity ;for _adca :=1;_adca <=_dbcd ;_adca ++{_dgaa ,_ceg :=_bbbf ._baed .GetPage (_adca );if _ceg !=nil {return _ceg ;};_cbb ,_ceg :=_cd .New (_dgaa );if _ceg !=nil {return _ceg ;
};_bag ,_ ,_ ,_ceg :=_cbb .ExtractPageText ();if _ceg !=nil {return _ceg ;};_ggdf :=_bag .GetContentStreamOps ();_dbbg ,_fdcd ,_ceg :=_bbbf .redactPage (_ggdf ,_dgaa .Resources );if _fdcd ==nil {_c .Log .Info ("N\u006f\u0020\u006d\u0061\u0074\u0063\u0068\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0066\u006f\u0072\u0020t\u0068\u0065\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065d \u0070\u0061\u0074t\u0061r\u006e\u002e");
_fdcd =_ggdf ;};_cdda :=_g .ContentStreamOperation {Operand :"\u006e"};*_fdcd =append (*_fdcd ,&_cdda );_dgaa .SetContentStreams ([]string {_fdcd .String ()},_b .NewFlateEncoder ());if _ceg !=nil {return _ceg ;};_bfbd ,_ceg :=_dgaa .GetMediaBox ();if _ceg !=nil {return _ceg ;
};if _dgaa .MediaBox ==nil {_dgaa .MediaBox =_bfbd ;};if _gada :=_bbbf ._feba .AddPage (_dgaa );_gada !=nil {return _gada ;};_dd .Slice (_dbbg ,func (_dfda ,_aeee int )bool {return _dbbg [_dfda ]._aegc < _dbbg [_aeee ]._aegc });_dcc :=_bfbd .Ury ;for _ ,_gaag :=range _dbbg {_cdb :=_gaag ._gcg ;
_cbag :=_bbbf ._feba .NewRectangle (_cdb .Llx ,_dcc -_cdb .Lly ,_cdb .Urx -_cdb .Llx ,-(_cdb .Ury -_cdb .Lly ));_cbag .SetFillColor (_ccg );_cbag .SetBorderWidth (_cbc );_cbag .SetFillOpacity (_ffcb );if _fce :=_bbbf ._feba .Draw (_cbag );_fce !=nil {return nil ;
};};};_bbbf ._feba .SetOutlineTree (_bbbf ._baed .GetOutlineTree ());return nil ;};func _cfc (_gga *targetMap ,_bde []int ){var _gbcd [][]int ;for _dgca ,_cegb :=range _gga ._cddb {if _dgff (_dgca ,_bde ){continue ;};_gbcd =append (_gbcd ,_cegb );};_gga ._cddb =_gbcd ;
};func _aadc (_beg []int ,_gff *_cd .TextMarkArray ,_cbeb string )(*_cd .TextMarkArray ,matchedBBox ,error ){_ffce :=matchedBBox {};_fba :=_beg [0];_ffec :=_beg [1];_fbdf :=len (_cbeb )-len (_a .TrimLeft (_cbeb ,"\u0020"));_dggd :=len (_cbeb )-len (_a .TrimRight (_cbeb ,"\u0020\u000a"));
_fba =_fba +_fbdf ;_ffec =_ffec -_dggd ;_cbeb =_a .Trim (_cbeb ,"\u0020\u000a");_cefb ,_bbbc :=_gff .RangeOffset (_fba ,_ffec );if _bbbc !=nil {return nil ,_ffce ,_bbbc ;};_eae ,_ecfd :=_cefb .BBox ();if !_ecfd {return nil ,_ffce ,_df .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_cefb );
};_ffce =matchedBBox {_aegc :_cbeb ,_gcg :_eae };return _cefb ,_ffce ,nil ;};

// RectangleProps defines properties of the redaction rectangle to be drawn.
type RectangleProps struct{FillColor _ac .Color ;BorderWidth float64 ;FillOpacity float64 ;};func _ggeg (_fbcg string )(string ,[][]int ){_cgdcb :=_e .MustCompile ("\u005c\u006e");_aebfg :=_cgdcb .FindAllStringIndex (_fbcg ,-1);_cecc :=_cgdcb .ReplaceAllString (_fbcg ,"\u0020");
return _cecc ,_aebfg ;};func _gde (_ebaf *matchedIndex ,_add [][]int )(bool ,[][]int ){_efed :=[][]int {};for _ ,_dggac :=range _add {if _ebaf ._dcgea < _dggac [0]&&_ebaf ._abg > _dggac [1]{_efed =append (_efed ,_dggac );};};return len (_efed )> 0,_efed ;
};func _gd (_ba *_g .ContentStreamOperation ,_da _b .PdfObject ,_ad []localSpanMarks )error {_eag ,_dga :=_b .GetArray (_ba .Params [0]);_fd :=[]_b .PdfObject {};if !_dga {_c .Log .Debug ("\u0045\u0052\u0052OR\u003a\u0020\u0054\u004a\u0020\u006f\u0070\u003d\u0025s\u0020G\u0065t\u0041r\u0072\u0061\u0079\u0056\u0061\u006c\u0020\u0066\u0061\u0069\u006c\u0065\u0064",_ba );
return _df .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_ba );
};_bcb ,_fdd :=_ceda (_ad );if len (_fdd )==1{_gf :=_fdd [0];_ae :=_bcb [_gf ];if len (_ae )==1{_ga :=_ae [0];_ggd :=_ga ._faa ;_cgg :=_ab (_ggd );_eeg ,_cc :=_cafg (_da ,_cgg );if _cc !=nil {return _cc ;};_dc ,_cc :=_gaa (_ga ,_ggd ,_cgg ,_eeg ,_gf );
if _cc !=nil {return _cc ;};for _ ,_ddf :=range _eag .Elements (){if _ddf ==_da {_fd =append (_fd ,_dc ...);}else {_fd =append (_fd ,_ddf );};};}else {_aeg :=_ae [0]._faa ;_bdg :=_ab (_aeg );_dbb ,_cef :=_cafg (_da ,_bdg );if _cef !=nil {return _cef ;};
_age ,_cef :=_eaf (_dbb ,_ae );if _cef !=nil {return _cef ;};_aec :=_fef (_age );_dbd :=_fcd (_dbb ,_aec ,_bdg );for _ ,_gfe :=range _eag .Elements (){if _gfe ==_da {_fd =append (_fd ,_dbd ...);}else {_fd =append (_fd ,_gfe );};};};_ba .Params [0]=_b .MakeArray (_fd ...);
}else if len (_fdd )> 1{_fed :=_ad [0];_dea :=_fed ._faa ;_ ,_eedg :=_bge (_dea );_afb :=_dea .Elements ()[_eedg ];_efa :=_afb .Font ;_bb ,_ca :=_cafg (_da ,_efa );if _ca !=nil {return _ca ;};_cae ,_ca :=_eaf (_bb ,_ad );if _ca !=nil {return _ca ;};_gge :=_fef (_cae );
_bf :=_fcd (_bb ,_gge ,_efa );for _ ,_gef :=range _eag .Elements (){if _gef ==_da {_fd =append (_fd ,_bf ...);}else {_fd =append (_fd ,_gef );};};_ba .Params [0]=_b .MakeArray (_fd ...);};return nil ;};type localSpanMarks struct{_faa *_cd .TextMarkArray ;
_adb int ;_ccf string ;};func _dgcg (_bfgc *_cd .TextMarkArray ,_adcb int ,_cda int )int {_fgc :=_bfgc .Elements ();_cega :=_adcb -1;_dafg :=_adcb +1;_caec :=-1;if _cega >=0{_fbe :=_fgc [_cega ];_afaa :=_fbe .ObjString ;_dabd :=len (_afaa );_cec :=_fbe .Index ;
if _cec +1< _dabd {_caec =_cega ;return _caec ;};};if _dafg < len (_fgc ){_deeg :=_fgc [_dafg ];_agf :=_deeg .ObjString ;if _agf [0]!=_deeg .Text {_caec =_dafg ;return _caec ;};};return _caec ;};type matchedIndex struct{_dcgea int ;_abg int ;_dade string ;
};func _acbb (_bed ,_daf string )[]int {if len (_daf )==0{return nil ;};var _gdg []int ;for _fec :=0;_fec < len (_bed );{_ggfa :=_a .Index (_bed [_fec :],_daf );if _ggfa < 0{return _gdg ;};_gdg =append (_gdg ,_fec +_ggfa );_fec +=_ggfa +len (_daf );};return _gdg ;
};

// RedactionTerm holds the regexp pattern and the replacement string for the redaction process.
type RedactionTerm struct{Pattern *_e .Regexp ;};func _dba (_gdee RedactionTerm )(*regexMatcher ,error ){return &regexMatcher {_eefe :_gdee },nil };func _ffbe (_aead *matchedIndex ,_efdd [][]int )[]*matchedIndex {_gdae :=[]*matchedIndex {};_afaeb :=_aead ._dcgea ;
_fbcf :=_afaeb ;_fbed :=_aead ._dade ;_ffd :=0;for _ ,_bgag :=range _efdd {_gcab :=_bgag [0]-_afaeb ;if _ffd >=_gcab {continue ;};_acg :=_fbed [_ffd :_gcab ];_ggag :=&matchedIndex {_dade :_acg ,_dcgea :_fbcf ,_abg :_bgag [0]};if len (_a .TrimSpace (_acg ))!=0{_gdae =append (_gdae ,_ggag );
};_ffd =_bgag [1]-_afaeb ;_fbcf =_afaeb +_ffd ;};_aab :=_fbed [_ffd :];_dce :=&matchedIndex {_dade :_aab ,_dcgea :_fbcf ,_abg :_aead ._abg };if len (_a .TrimSpace (_aab ))!=0{_gdae =append (_gdae ,_dce );};return _gdae ;};func _bge (_ced *_cd .TextMarkArray )(_b .PdfObject ,int ){var _gbb _b .PdfObject ;
_efe :=-1;for _dgf ,_agb :=range _ced .Elements (){_gbb =_agb .DirectObject ;_efe =_dgf ;if _gbb !=nil {break ;};};return _gbb ,_efe ;};func _fef (_efcd []placeHolders )[]replacement {_dcbe :=[]replacement {};for _ ,_aa :=range _efcd {_bef :=_aa ._cf ;
_cdg :=_aa ._ff ;_afae :=_aa ._bc ;for _ ,_abd :=range _bef {_bfg :=replacement {_cfg :_cdg ,_ge :_afae ,_de :_abd };_dcbe =append (_dcbe ,_bfg );};};_dd .Slice (_dcbe ,func (_cba ,_cgd int )bool {return _dcbe [_cba ]._de < _dcbe [_cgd ]._de });return _dcbe ;
};func _fcd (_dfg string ,_edd []replacement ,_eb *_ce .PdfFont )[]_b .PdfObject {_geaa :=[]_b .PdfObject {};_ade :=0;_gee :=_dfg ;for _ecgc ,_dfc :=range _edd {_feb :=_dfc ._de ;_dead :=_dfc ._ge ;_fff :=_dfc ._cfg ;_eec :=_b .MakeFloat (_dead );if _ade > _feb ||_feb ==-1{continue ;
};_aee :=_dfg [_ade :_feb ];_gfc :=_acf (_aee ,_eb );_cgf :=_b .MakeStringFromBytes (_gfc );_geaa =append (_geaa ,_cgf );_geaa =append (_geaa ,_eec );_ebf :=_feb +len (_fff );_gee =_dfg [_ebf :];_ade =_ebf ;if _ecgc ==len (_edd )-1{_gfc =_acf (_gee ,_eb );
_cgf =_b .MakeStringFromBytes (_gfc );_geaa =append (_geaa ,_cgf );};};return _geaa ;};func _agbf (_egeg []*matchedIndex ,_ccb [][]int )[]*matchedIndex {_geff :=[]*matchedIndex {};for _ ,_dcca :=range _egeg {_dbga ,_ddb :=_gde (_dcca ,_ccb );if _dbga {_abegc :=_ffbe (_dcca ,_ddb );
_geff =append (_geff ,_abegc ...);}else {_geff =append (_geff ,_dcca );};};return _geff ;};

// Write writes the content of `re.creator` to writer of type io.Writer interface.
func (_bgabb *Redactor )Write (writer _fb .Writer )error {return _bgabb ._feba .Write (writer )};func _ffc (_dcb *_ce .PdfFont ,_gdd _cd .TextMark )float64 {_caf :=0.001;_afbg :=_gdd .Th /100;if _dcb .Subtype ()=="\u0054\u0079\u0070e\u0033"{_caf =1;};_eede ,_geg :=_dcb .GetRuneMetrics (' ');
if !_geg {_eede ,_geg =_dcb .GetCharMetrics (32);};if !_geg {_eede ,_ =_ce .DefaultFont ().GetRuneMetrics (' ');};_afag :=_caf *((_eede .Wx *_gdd .FontSize +_gdd .Tc +_gdd .Tw )/_afbg );return _afag ;};func _ceda (_dbg []localSpanMarks )(map[string ][]localSpanMarks ,[]string ){_eee :=make (map[string ][]localSpanMarks );
_dbc :=[]string {};for _ ,_cedc :=range _dbg {_ggde :=_cedc ._ccf ;if _afe ,_dee :=_eee [_ggde ];_dee {_eee [_ggde ]=append (_afe ,_cedc );}else {_eee [_ggde ]=[]localSpanMarks {_cedc };_dbc =append (_dbc ,_ggde );};};return _eee ,_dbc ;};type regexMatcher struct{_eefe RedactionTerm };
type replacement struct{_cfg string ;_ge float64 ;_de int ;};func _cbef (_caag []*targetMap ){for _baa ,_gdf :=range _caag {for _adf ,_edea :=range _caag {if _baa !=_adf {_aceg ,_aadg :=_abed (*_gdf ,*_edea );if _aceg {_cfc (_edea ,_aadg );};};};};};type targetMap struct{_ffe string ;
_cddb [][]int ;};func _gaa (_ecg localSpanMarks ,_aegd *_cd .TextMarkArray ,_efc *_ce .PdfFont ,_gea ,_cga string )([]_b .PdfObject ,error ){_dca :=_caa (_aegd );Tj ,_fbf :=_eegec (_aegd );if _fbf !=nil {return nil ,_fbf ;};_ggf :=len (_gea );_ddc :=len (_dca );
_edbc :=-1;_fbg :=_b .MakeFloat (Tj );if _dca !=_cga {_afc :=_ecg ._adb ;if _afc ==0{_edbc =_a .LastIndex (_gea ,_dca );}else {_edbc =_a .Index (_gea ,_dca );};}else {_edbc =_a .Index (_gea ,_dca );};_fg :=_edbc +_ddc ;_fdc :=[]_b .PdfObject {};if _edbc ==0&&_fg ==_ggf {_fdc =append (_fdc ,_fbg );
}else if _edbc ==0&&_fg < _ggf {_dcge :=_acf (_gea [_fg :],_efc );_baf :=_b .MakeStringFromBytes (_dcge );_fdc =append (_fdc ,_fbg ,_baf );}else if _edbc > 0&&_fg >=_ggf {_ecf :=_acf (_gea [:_edbc ],_efc );_ede :=_b .MakeStringFromBytes (_ecf );_fdc =append (_fdc ,_ede ,_fbg );
}else if _edbc > 0&&_fg < _ggf {_cfe :=_acf (_gea [:_edbc ],_efc );_dgd :=_acf (_gea [_fg :],_efc );_ggc :=_b .MakeStringFromBytes (_cfe );_cbe :=_b .MakeString (string (_dgd ));_fdc =append (_fdc ,_ggc ,_fbg ,_cbe );};return _fdc ,nil ;};func _dgff (_cbaf int ,_bage []int )bool {for _ ,_cce :=range _bage {if _cce ==_cbaf {return true ;
};};return false ;};